<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org" lang="en">
<head th:replace="fragments :: head"></head>
<link rel="stylesheet" href="css/account.css">
<body>

<div class="page-content">

  <div th:replace="fragments :: navbar"></div>

  <div class="no-user" th:unless="${user}">

    <div>Please <a href="/login"><span class="clickable">login</span></a> to view your account</div>

    <div>or <a href="/register"><span class="clickable">register</span></a> to create a new account</div>

  </div>

  <div class="account-container" th:if="${user}">

    <div class="header">My Account</span></div>

    <div class="view-options">
      <ul>
        <li class="show-content">My Details</li>
        <li class="show-content">My Favorites</li>
        <li class="show-content">My Reviews</li>
      </ul>
    </div>

    <div class="account-content">

      <div class="details-content content">
        <form action="/account" method="POST" th:object="${userDto}" style="width: 100%;">

          <div class="full-name info">
            <label for="fullName">Account Name: </label>
            <input th:field="*{fullname}" th:value="${user.fullname}" name="fullName" id="fullName" type="text"/>
          </div>
          <div class="email info">
            <label for="email">Email Address: </label>
            <input th:field="*{username}" th:value="${user.username}" name="email" id="email" type="text"/>
            <span th:if="${userexist}" style="color: red;">Username is Taken</span>
            <div th:if="${#fields.hasErrors('username')}" th:errors="*{username}" class="error-message"></div>
          </div>
          <div class="location info">
            <label for="location">Account Location: </label>
            <input th:field="*{location}" th:value="${user.location}" name="location" id="location" type="text"/>
          </div>
          <input class="btn btn-success" style="margin: 10px;" type="submit" value="save changes"/>

        </form>
      </div>

      <div class="favorites-content content">

        <th:block th:each="restaurant : ${favoriteRestaurants}">

            <div class="favorite-restaurant">
              <a th:href="@{/restaurant(placeId=${restaurant.getPlace_id()})}">
                <div class="img-container">
                  <img class="restaurant-image"
                       th:if="${restaurant.getAllPhotos().get(0) != 'No photos available'}"
                       th:src="${restaurant.getAllPhotos().get(0)}"/>
                  <p class="photo-validation"
                     th:unless="${restaurant.getAllPhotos().get(0) != 'No photos available'}">No Photo available :(</p>
                </div>
              </a>
              <div class="info-container">
                <div class="listing-info" style="font-size: 25px;" th:text="${restaurant.getName()}"></div>
                <form action="/account/favorite/delete" method="POST">
                  <input type="hidden" th:value="${restaurant.getPlace_id()}" name="place_id"/>
                  <button class="remove-favorite">
                    <i class="fa fa-trash w3 xxx-large"></i>
                  </button>
                </form>
              </div>
            </div>

        </th:block>


      </div>

      <div class="reviews-content content">

        <div class="restaurant-column">
          <th:block th:each="restaurant : ${reviewedRestaurants}">

            <a th:href="@{/restaurant(placeId=${restaurant.getPlace_id()})}">
              <div class="review-restaurant">

              <span class="review-info-container">
                <div class="review-listing-info" style="font-size: 25px;" th:text="${restaurant.getName()}"></div>
              </span>
              <span class="review-img-container">
                <img class="review-restaurant-image"
                     th:if="${restaurant.getAllPhotos().get(0) != 'No photos available'}"
                     th:src="${restaurant.getAllPhotos().get(0)}"/>
                <p class="review-photo-validation"
                   th:unless="${restaurant.getAllPhotos().get(0) != 'No photos available'}">No Photo available :(</p>
              </span>

              </div>
            </a>

          </th:block>
        </div>

        <div class="review-column">
          <th:block th:each="review : ${user.getReviews()}">
            <div class="review">
              <div class="edit-delete">

                  <button class="edit-review"><i class="fa fa-edit"></i>
                  </button>

                <form action="account/review/delete" method="POST">
                  <input type="hidden" name="reviewId" th:value="${review.getReviewId()}"/>
                  <button class="delete-review"><i class="fa fa-trash"></i>
                  </button>
                </form>
              </div>

              <div class="edit-review-content" style="display: none;">

                <form action="account/review/edit" method="POST" th:object="${reviewObject}">
                  <label>
                    Rating: <input type="text" name="ratings" th:field="*{ratings}" th:value="${review.getRatings()}"/>/5
                  </label>
                  <br>

                  <label>
                    Comments:
                    <br>

                    <textarea name="comments" th:field="*{comments}" th:value="${review.getComments()}"></textarea>
                  </label>

                  <input type="hidden" th:value="${review.getReviewId()}" name="reviewId"/>
                  <button type="submit" class="btn btn-success">Save Changes</button>
                </form>

              </div>

              <div class="display-review-content">
                <div>
                  Rating:
                  <p style="display: inline;" th:text="${review.getRatings()}"></p>/5
                </div>
                <br>

                <div>
                  Comments:
                  <br>

                  <p th:text="${review.getComments()}">No comments.</p>
                  <p th:unless="${review.getComments() != ''}">No comments.</p>
                </div>
              </div>


            </div>
          </th:block>
        </div>

        <script>
          document.addEventListener("DOMContentLoaded", function () {
              const editButtons = document.querySelectorAll(".edit-review");
              editButtons.forEach(button => {
                  button.addEventListener("click", function () {
                      const review = button.closest(".review");
                      review.querySelector(".edit-review-content").style.display = "block";
                      review.querySelector(".display-review-content").style.display = "none";
                  });
              });
          });
        </script>

      </div>

      <script>
        const showButtons = document.querySelectorAll('.show-content');
        const contentDivs = document.querySelectorAll('.content');

        showButtons.forEach((button, index) => {
            button.addEventListener('click', () => {
                contentDivs.forEach((div, divIndex) => {
                    if (index === divIndex) {
                        div.style.display = 'flex';
                    } else {
                        div.style.display = 'none';
                    }
                });
            });
        });
      </script>

  </div>

  </div></div>

</body>
</html>